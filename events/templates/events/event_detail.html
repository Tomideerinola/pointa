{%load humanize%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ event.title }} | Pointa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Outfit:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { 
            --pointa-purple: #6f42c1; 
            --soft-purple: #f3effb; 
            --dark-navy: #1a1a2e;
        }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #fcfcff; 
            color: #334155; 
        }

        /* Navbar Styling */
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
        }
        .navbar-brand span { font-family: 'Outfit'; font-weight: 800; font-size: 1.6rem; color: var(--pointa-purple); }
        
        /* Hero Styling */
        .event-hero-container {
            position: relative;
            border-radius: 32px;
            overflow: hidden;
            height: 480px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        .hero-img { width: 100%; height: 100%; object-fit: cover; }
        .hero-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            padding: 40px;
            color: white;
        }

        /* Content Styling */
        .info-pill {
            background: var(--soft-purple);
            color: var(--pointa-purple);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(111, 66, 193, 0.1);
        }
        
        .section-title { font-family: 'Outfit'; font-weight: 800; color: var(--dark-navy); margin-bottom: 20px; }
        .description-text { line-height: 1.8; font-size: 1.1rem; color: #475569; white-space: pre-line; }

        /* Sidebar Styling */
        .ticket-sidebar {
            position: sticky;
            top: 100px;
            background: #fff;
            border-radius: 28px;
            border: 1px solid #e2e8f0;
            padding: 32px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05);
        }

        .ticket-option {
            border: 1.5px solid #f1f5f9;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: 0.2s;
        }
        .ticket-option:hover { border-color: var(--pointa-purple); background: #fdfbff; }
        .ticket-option input:checked + label { width: 100%; }
        
        .btn-checkout {
            background: var(--pointa-purple);
            color: white;
            border-radius: 16px;
            padding: 16px;
            width: 100%;
            font-weight: 800;
            font-size: 1.15rem;
            border: none;
            margin-top: 20px;
            transition: 0.3s;
        }
        .btn-checkout:hover { background: #5a32a3; transform: translateY(-3px); box-shadow: 0 10px 20px rgba(111, 66, 193, 0.2); }

        .venue-card {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .glass-category {
        background: rgba(111, 66, 193, 0.85); /* Pointa Purple with transparency */
        backdrop-filter: blur(8px); /* Blurs the image behind the badge */
        -webkit-backdrop-filter: blur(8px);
        color: #ffffff !important;
        border: 1px solid rgba(255, 255, 255, 0.2);
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    .hero-overlay {
        position: absolute; 
        bottom: 0; 
        left: 0; 
        right: 0;
        padding: 60px 40px;
        /* Improved gradient: darker at the bottom for text contrast */
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
    }

    .event-title-main {
        font-family: 'Outfit'; 
        font-weight: 800; 
        color: #ffffff; 
        text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        margin-top: 10px;
    }
    .navbar {
            padding: 1rem 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #eee;
        }

        .navbar-brand-custom {
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 1.8rem;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none !important;
        }

        .brand-text {
            background: linear-gradient(45deg, var(--primary-purple), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        * Pointa Navigation Specific Styles */
    .nav-link-pointa {
        color: #1a1a2e;
        font-weight: 700;
        font-size: 0.95rem;
        transition: 0.3s;
        padding: 8px 16px;
        border-radius: 10px;
    }
    .nav-link-pointa:hover {
        background-color: #f3effb; /* soft-purple */
        color: #6f42c1;
    }
    
    .btn-pointa-primary {
        background-color: #6f42c1;
        color: #ffffff;
        font-weight: 800;
        border-radius: 12px;
        padding: 10px 24px;
        border: none;
        transition: 0.3s;
        box-shadow: 0 4px 12px rgba(111, 66, 193, 0.2);
    }
    .btn-pointa-primary:hover {
        background-color: #5a32a3;
        transform: translateY(-2px);
        color: #fff;
    }

    .btn-pointa-outline {
        border: 1.5px solid #e2e8f0;
        color: #64748b;
        font-weight: 700;
        border-radius: 12px;
        padding: 10px 20px;
        transition: 0.3s;
    }
    .btn-pointa-outline:hover {
        border-color: #6f42c1;
        color: #6f42c1;
        background: transparent;
    }
    /* --- NAVIGATION THEME --- */
    .navbar {
            padding: 1rem 0;
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #f1f5f9;
        }

        .navbar-brand-custom {
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 1.8rem;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none !important;
            color: var(--pointa-purple) !important;
        }

        .brand-text {
            background: linear-gradient(45deg, var(--pointa-purple), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-link-pointa {
            color: var(--dark-navy) !important;
            font-weight: 700;
            font-size: 0.95rem;
            transition: 0.3s;
            padding: 8px 20px !important;
            border-radius: 10px;
        }

        .nav-link-pointa:hover {
            background-color: var(--soft-purple);
            color: var(--pointa-purple) !important;
        }

        /* --- BUTTONS --- */
        .btn-purple {
            background-color: var(--pointa-purple) !important;
            color: white !important;
            font-weight: 800;
            border-radius: 12px;
            padding: 10px 24px;
            border: none;
            transition: 0.3s;
        }
        .btn-purple:hover {
            background-color: #5a32a3 !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(111, 66, 193, 0.2);
        }

        .btn-logout-custom {
            border: 1.5px solid #fee2e2;
            color: #ef4444;
            font-weight: 700;
            border-radius: 12px;
            padding: 8px 18px;
            transition: 0.3s;
        }
        .btn-logout-custom:hover {
            background: #fef2f2;
            border-color: #ef4444;
            color: #b91c1c;
        }
        /* Content Expansion Styles */
    .detail-card {
        background: #fff;
        border: 1px solid #f1f5f9;
        border-radius: 24px;
        padding: 30px;
        margin-bottom: 30px;
    }
    .map-container {
        width: 100%;
        height: 350px;
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid #e2e8f0;
    }
    .quick-fact-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: #f8fafc;
        border-radius: 16px;
    }
    .quick-fact-item i {
        color: var(--pointa-purple);
        font-size: 1.2rem;
    }
    .organizer-chip {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 8px 16px;
        background: var(--soft-purple);
        border-radius: 50px;
        font-weight: 600;
        color: var(--pointa-purple);
        text-decoration: none;
    }
    /* Quantity Selector Styling */
    .qty-group {
        display: flex;
        align-items: center;
        background: var(--soft-purple);
        border-radius: 12px;
        padding: 5px;
        width: fit-content;
    }
    .qty-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: none;
        background: white;
        color: var(--pointa-purple);
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .qty-btn:hover { background: var(--pointa-purple); color: white; }
    
    .qty-input {
        width: 45px;
        text-align: center;
        border: none;
        background: transparent;
        font-weight: 800;
        color: var(--dark-navy);
        pointer-events: none; /* User must use buttons */
    }

    /* Summary Box */
    .price-summary {
        background: #f8fafc;
        border-radius: 16px;
        padding: 20px;
        border: 1px dashed #e2e8f0;
    }

    /* Selection Highlighting */
    .ticket-option input:checked + .ticket-content {
        border-color: var(--pointa-purple);
        background-color: #fdfbff;
    }
    
    .ticket-content {
        border: 1.5px solid #f1f5f9;
        border-radius: 16px;
        padding: 16px;
        width: 100%;
        cursor: pointer;
        display: block;
        transition: 0.2s;
    }

    /* Radio Selection Styling */
    .ticket-option-wrapper {
        position: relative;
        margin-bottom: 15px;
    }

    /* The Card Appearance */
    .ticket-content-card {
        border: 2px solid #f1f5f9;
        border-radius: 20px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #fff;
        display: block;
    }

    /* When Radio is checked, style the card border */
    input[name="ticket_id"]:checked + .ticket-content-card {
        border-color: var(--pointa-purple);
        background-color: #fdfbff;
        box-shadow: 0 10px 20px rgba(111, 66, 193, 0.05);
    }

    /* Customizing the Radio Button color to match Pointa Purple */
    input[name="ticket_id"] {
        accent-color: var(--pointa-purple);
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    /* Quantity Controls */
    .qty-group {
        display: flex;
        align-items: center;
        background: #f1f5f9;
        border-radius: 14px;
        padding: 6px;
    }
    .qty-btn {
        width: 35px;
        height: 35px;
        border-radius: 10px;
        border: none;
        background: white;
        color: var(--pointa-purple);
        font-weight: 800;
        transition: 0.2s;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .qty-btn:hover { background: var(--pointa-purple); color: white; }
    .qty-input {
        width: 40px;
        text-align: center;
        border: none;
        background: transparent;
        font-weight: 800;
        font-size: 1.1rem;
    }

    .price-summary {
        background: var(--soft-purple);
        border-radius: 20px;
        padding: 20px;
        border: 1px solid rgba(111, 66, 193, 0.1);
    }
    .save-btn {
        border: 2px solid #e2e8f0;
        background: white;
        color: #64748b;
        width: 50px;
        height: 50px;
        border-radius: 15px;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    /* The "Saved" State */
    .save-btn.is-saved {
        background: #fff1f2;
        border-color: #fda4af;
        color: #e11d48; /* Red heart color */
        transform: scale(1.1);
    }

    .save-btn:hover {
        transform: translateY(-3px);
    }
    
    .save-btn i {
        font-size: 1.4rem;
        transition: transform 0.2s ease;
    }

    .save-btn:active i {
        transform: scale(0.7);
    }



    .dashboard-user-pill {
        display: inline-flex;
        align-items: center;
        background: #f8fafc; /* Very light grey */
        border: 1px solid #e2e8f0;
        padding: 6px 16px 6px 8px;
        border-radius: 100px;
        text-decoration: none !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        color: #0f172a !important;
    }

    .user-avatar-circle {
        width: 32px;
        height: 32px;
        background: var(--primary-purple);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-size: 0.8rem;
        box-shadow: 0 4px 10px rgba(109, 40, 217, 0.2);
    }

    .user-pill-text {
        font-weight: 700;
        font-size: 0.9rem;
    }

    /* The "Alive" Hover State */
    .dashboard-user-pill:hover {

        border-color: var(--primary-purple);
        box-shadow: 0 10px 20px rgba(109, 40, 217, 0.1);
        transform: translateY(-2px);
    }

    .dashboard-user-pill:hover .user-avatar-circle {
        transform: scale(1.1) rotate(-10deg);
        background: #5b21b6; /* Slightly darker purple on hover */
    }

    .dashboard-user-pill:active {
        transform: translateY(0);
    }

    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container">
            <!-- Brand -->
            <a class="navbar-brand-custom" href="{%url 'home'%}"> <span style="color: var(--primary-purple); line-height: 0;"> <svg width="40" height="40" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg"> <g clip-path="url(#clip0_18078_104881)"> <mask id="mask0_18078_104881" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="0" y="0" width="34" height="34"> <path d="M25.5 0H8.5C3.80558 0 0 3.80558 0 8.5V25.5C0 30.1944 3.80558 34 8.5 34H25.5C30.1944 34 34 30.1944 34 25.5V8.5C34 3.80558 30.1944 0 25.5 0Z" fill="white" /> </mask> <g mask="url(#mask0_18078_104881)"> <path d="M25.5 0H8.5C3.80558 0 0 3.80558 0 8.5V25.5C0 30.1944 3.80558 34 8.5 34H25.5C30.1944 34 34 30.1944 34 25.5V8.5C34 3.80558 30.1944 0 25.5 0Z" fill="currentColor" /> <path d="M16.1238 20.1522C16.511 19.662 17.2479 19.6428 17.66 20.1122L20.5526 23.41C21.1194 24.0563 20.6611 25.0689 19.8016 25.0692H14.3055C13.47 25.0692 13.0026 24.1059 13.5203 23.4501L16.1238 20.1522ZM16.1326 8.45497C16.5308 7.95801 17.286 7.95453 17.6883 8.44813L27.5164 20.5077C28.0488 21.161 27.5838 22.1395 26.741 22.1395H24.4442C24.1428 22.1395 23.8577 22.0034 23.6678 21.7694L17.7029 14.4188C17.2962 13.9175 16.5285 13.927 16.1346 14.4384L10.7303 21.454C10.5411 21.6996 10.2484 21.8435 9.9383 21.8436H7.4881C6.64925 21.8436 6.18332 20.8733 6.70783 20.2186L16.1326 8.45497Z" fill="white" /> </g> </g> <defs><clipPath id="clip0_18078_104881"><rect width="34" height="34" fill="white" /></clipPath></defs> </svg> </span> <span class="brand-text">Pointa</span> </a>
    
            <!-- Hamburger toggler -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navPointa" aria-controls="navPointa" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
    
            <!-- Collapsible content -->
            <div class="collapse navbar-collapse" id="navPointa">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link px-3" href="{%url 'home'%}">Home</a></li>
                    <li class="nav-item"><a class="nav-link px-3" href="{% url 'events_list' %}">Explore Events</a></li>
                </ul>
                <div class="d-flex align-items-center gap-2">

                    {% if user.is_authenticated and not user.is_staff and not user.is_superuser %}
                
                        {% if user.organizer %}
                            <a href="{% url 'org_dashboard' %}" class="btn text-dark fw-bold px-3">
                                Dashboard
                            </a>
                        {% else %}
                        <a href="{% url 'dashboard' %}" class="dashboard-user-pill">
                            <div class="user-avatar-circle">
                                <i class="fa-solid fa-user-astronaut"></i>
                            </div>
                            <span class="user-pill-text">Hello, {{ user.first_name|capfirst }}!</span>
                            <i class="fa-solid fa-chevron-right ms-2 opacity-50" style="font-size: 10px;"></i>
                        </a>
                        {% endif %}
                
                        <form method="POST" action="{% url 'logout' %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-danger px-3">
                                Logout
                            </button>
                        </form>
                
                    {% else %}
                
                        <a href="{% url 'user_login' %}" class="btn text-dark fw-bold px-3">
                            Sign In
                        </a>
                        <a href="{% url 'organizer_signup' %}" class="btn btn-purple shadow-sm px-4">
                            Create Event
                        </a>
                
                    {% endif %}
                
                </div>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="event-hero-container mb-5">

            {% if event.image %}
                <img src="{{ event.image.url }}" class="hero-img" alt="{{ event.title }}">
            {% else %}
                <div class="hero-img bg-dark d-flex align-items-center justify-content-center text-white">
                    <i class="fa-solid fa-image fa-4x opacity-25"></i>
                </div>
            {% endif %}
            <div class="hero-overlay">
                <span class="badge glass-category rounded-pill px-3 py-2 fw-bold shadow-sm">
                    <i class="fa-solid fa-tag me-1 small"></i> {{ event.category.name }}
                </span>
                
                <h1 class="display-4 event-title-main">
                    {{ event.title }}
                </h1>
            </div>
        </div>

        <div class="row g-5">
            <div class="col-lg-8">
                <div class="d-flex flex-wrap gap-3 mb-5">
                    <div class="info-pill"><i class="fa-solid fa-calendar-days"></i> {{ event.date|date:"l, d F Y" }}</div>
                    <div class="info-pill"><i class="fa-solid fa-clock"></i> {{ event.start_time|time:"h:i A" }} - {{ event.end_time|time:"h:i A" }}</div>
                    <div class="info-pill"><i class="fa-solid fa-location-arrow"></i> {{ event.event_type|title }}</div>
                    <button id="save-event-btn" 
                    class="save-btn {% if is_saved %}is-saved{% endif %}" 
                    data-event-id="{{ event.id }}">
                    <i class="{% if is_saved %}fa-solid{% else %}fa-regular{% endif %} fa-heart"></i>
                </button>
                </div>
            
                <div class="mb-5">
                    <a href="#" class="organizer-chip mb-3">
                        <i class="fas fa-shield-alt"></i> Verified Organizer: {{ event.organizer.organization_name }}
                    </a>
                    <h3 class="section-title mt-4">Event Description</h3>
                    <div class="description-text">
                        {{ event.description|linebreaks }}
                    </div>
                </div>
            
                <div class="row g-3 mb-5">
                    <div class="col-md-6">
                        <div class="quick-fact-item">
                            <i class="fa-solid fa-door-open"></i>
                            <div>
                                <span class="d-block small text-muted">Doors Open</span>
                                <span class="fw-bold">{{ event.start_time|time:"h:i A" }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="quick-fact-item">
                            <i class="fa-solid fa-user-group"></i>
                            <div>
                                <span class="d-block small text-muted">Expected Crowd</span>
                                <span class="fw-bold">500+ Attendees</span>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="detail-card">
                    <h3 class="section-title">Venue & Location</h3>
                    <div class="venue-card mb-4 border-0 p-0">
                        <div class="bg-purple-subtle rounded-circle d-flex align-items-center justify-content-center" style="width: 56px; height: 56px; background: var(--soft-purple);">
                            <i class="fa-solid fa-map-location-dot text-purple fs-4"></i>
                        </div>
                        <div>
                            <h5 class="fw-bold mb-1">{{ event.venue }}</h5>
                            <p class="text-muted mb-0">{{ event.city }}, {{ event.state|title }}</p>
                        </div>
                    </div>
                    
                    <div class="map-container">
                        <iframe 
                            width="100%" 
                            height="100%" 
                            frameborder="0" style="border:0"
                            src="https://www.google.com/maps/embed/v1/place?key=YOUR_GOOGLE_MAPS_API_KEY&q={{ event.venue|urlencode }},{{ event.city|urlencode }}" 
                            allowfullscreen>
                        </iframe>
                    </div>
                    <p class="small text-muted mt-3 text-center">
                        <i class="fa-solid fa-info-circle me-1"></i> 
                        Pro tip: Arrive 30 minutes early to secure the best parking spots.
                    </p>
                </div>
            
                <div class="mb-5">
                    <h3 class="section-title">Frequently Asked Questions</h3>
                    <div class="accordion accordion-flush rounded-4 overflow-hidden border" id="eventFaq">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    What is the refund policy?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#eventFaq">
                                <div class="accordion-body text-muted">
                                    Tickets are generally non-refundable unless the event is canceled or rescheduled by the organizer.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    Is parking available at the venue?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#eventFaq">
                                <div class="accordion-body text-muted">
                                    Yes, there is secure parking available at {{ event.venue }} for all ticket holders.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="ticket-sidebar shadow-sm border p-4 rounded-5 bg-white">
                    {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
                    <h4 class="section-title mb-4">Select Tickets</h4>

                    
                    <form action="{% url 'booking_confirm' event.id %}" method="POST" id="ticketForm">
                        {% csrf_token %}
                        
                        <div class="ticket-list mb-4">
                            {% for ticket in tickets %}
                            <div class="ticket-option-wrapper">
                                <input type="radio" name="ticket_id" id="ticket{{ ticket.id }}" 
                                       value="{{ ticket.id }}" data-price="{{ ticket.price }}"
                                       class="position-absolute mt-4 ms-3" 
                                       {% if forloop.first %}checked{% endif %} style="z-index: 5;">
                                
                                <label class="ticket-content-card ps-5" for="ticket{{ ticket.id }}">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="ms-2">
                                            <span class="fw-800 d-block text-dark fs-5">{{ ticket.name }}</span>
                                            <span class="small text-muted">
                                                <i class="fa-solid fa-ticket-simple me-1"></i> {{ ticket.quantity_available }} left
                                            </span>
                                        </div>
                                        <span class="text-purple fw-800 h5 mb-0">₦{{ ticket.price|floatformat:0|intcomma }}</span>
                                    </div>
                                </label>
                            </div>
                            {% empty %}
                            <div class="text-center py-4 bg-light rounded-4">
                                <p class="text-muted mb-0 small">Tickets are currently unavailable.</p>
                            </div>
                            {% endfor %}
                        </div>
            
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <span class="fw-800 text-dark">Number of tickets</span>
                            <div class="qty-group">
                                <button type="button" class="qty-btn" onclick="updateQty(-1)">-</button>
                                <input type="number" name="quantity" id="ticketQty" class="qty-input" value="1" readonly>
                                <button type="button" class="qty-btn" onclick="updateQty(1)">+</button>
                            </div>
                        </div>
            
                        <div class="price-summary mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted small">Unit Price</span>
                                <span class="fw-bold" id="unitPrice">₦0</span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center pt-2 border-top border-white">
                                <span class="fw-800 text-dark">Total Amount</span>
                                <span class="fw-800 text-purple h3 mb-0" id="totalAmount">₦0</span>
                            </div>
                        </div>
            
                        <button type="submit" class="btn btn-purple w-100 py-3 rounded-4 shadow-sm fw-800">
                            Proceed to Checkout <i class="fa-solid fa-chevron-right ms-2 small"></i>
                        </button>
                    </form>
            
                    <div class="text-center mt-3">
                        <p class="text-muted small mb-0"><i class="fa-solid fa-lock me-1"></i> Payments are 100% secure</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function updateQty(change) {
            const qtyInput = document.getElementById('ticketQty');
            let currentQty = parseInt(qtyInput.value);
            let newQty = currentQty + change;
            if (newQty >= 1 && newQty <= 10) {
                qtyInput.value = newQty;
                calculateTotal();
            }
        }
    
        function calculateTotal() {
            const selectedRadio = document.querySelector('input[name="ticket_id"]:checked');
            const qty = parseInt(document.getElementById('ticketQty').value);
            
            if (selectedRadio) {
                const price = parseFloat(selectedRadio.getAttribute('data-price'));
                const total = price * qty;
                
                document.getElementById('unitPrice').innerText = "₦" + price.toLocaleString();
                document.getElementById('totalAmount').innerText = "₦" + total.toLocaleString();
            }
        }
    
        // Update whenever a different radio is clicked
        document.querySelectorAll('input[name="ticket_id"]').forEach(radio => {
            radio.addEventListener('change', calculateTotal);
        });
    
        // Run on load
        window.onload = calculateTotal;


    document.getElementById('save-event-btn').addEventListener('click', function() {
    const btn = this;
    const icon = btn.querySelector('i');
    const eventId = btn.getAttribute('data-event-id');

    // Simple AJAX call to your Django view
    fetch(`/event/${eventId}/toggle-save/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.saved) {
            // It's saved! Change to solid red heart
            btn.classList.add('is-saved');
            icon.classList.remove('fa-regular');
            icon.classList.add('fa-solid');
        } else {
            // Removed! Change back to regular heart
            btn.classList.remove('is-saved');
            icon.classList.remove('fa-solid');
            icon.classList.add('fa-regular');
        }
    })
    .catch(error => console.error('Error:', error));
});
    </script>
</body>
</html>