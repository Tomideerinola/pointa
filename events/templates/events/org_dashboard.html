{%load humanize%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizer Console | Pointa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&family=Outfit:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --pointa-purple: #6f42c1; 
            --accent-soft: #f8f6ff;
            --text-dark: #1a1a2e;
        }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #fdfdff; 
            color: var(--text-dark);
            margin: 0;
        }

        /* Sidebar Desktop */
        .sidebar { 
            width: 260px; 
            height: 100vh; 
            position: fixed; 
            background: #fff; 
            padding: 40px 24px; 
            border-right: 1px solid #f0f0f5;
            z-index: 1000;
        }

        .nav-link { 
            color: #64748b; 
            padding: 14px 18px; 
            border-radius: 16px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            transition: 0.3s; 
            font-weight: 600;
            margin-bottom: 8px;
        }

        .nav-link i { font-size: 1.1rem; width: 20px; }
        
        .nav-link:hover { 
            background: var(--accent-soft); 
            color: var(--pointa-purple); 
        }

        .nav-link.active { 
            background: var(--pointa-purple); 
            color: #fff !important; 
            box-shadow: 0 10px 20px rgba(111, 66, 193, 0.2); 
        }

        /* Main Content */
        .main-content { margin-left: 260px; padding: 40px 60px; transition: all 0.3s ease; }

        /* Mobile Navbar */
        .mobile-top-nav {
            display: none;
            background: #fff;
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f5;
            position: sticky;
            top: 0;
            z-index: 1001;
        }

        /* Beautiful Stat Cards */
        .stat-card { 
            background: #fff; 
            border-radius: 24px; 
            padding: 25px; 
            border: 1px solid #f0f0f5; 
            height: 100%;
        }

        .icon-square {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        /* Search & Buttons */
        .search-bar {
            background: #f1f5f9;
            border-radius: 14px;
            padding: 10px 20px;
            border: none;
            width: 100%;
            max-width: 300px;
        }

        .btn-create { 
            background: var(--pointa-purple); 
            color: #fff; 
            border-radius: 14px; 
            padding: 12px 24px; 
            font-weight: 700; 
            border: none; 
            white-space: nowrap;
        }

        /* Table Styling */
        .custom-table {
            background: #fff;
            border-radius: 24px;
            border: 1px solid #f0f0f5;
            margin-top: 20px;
        }
        .table-responsive { border-radius: 24px; }

        /* Responsive Breakpoints */
        @media (max-width: 991px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 25px 15px; }
            .mobile-top-nav { display: flex; align-items: center; justify-content: space-between; }
            .search-bar { max-width: 100%; margin-bottom: 15px; }
            .header-flex { flex-direction: column; align-items: flex-start !important; }
            .stat-card { padding: 20px; }
        }


        /* Styling for the new list-card layout */
    .transition-hover {
        transition: all 0.3s ease;
        border: 1px solid #f1f5f9 !important;
    }
    .transition-hover:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 24px rgba(111, 66, 193, 0.08) !important;
        border-color: var(--light-purple) !important;
    }

    .ls-1 { letter-spacing: 0.5px; }
    .x-small { font-size: 0.65rem; }
    
    .bg-soft-purple { background: #f3effb; }
    .text-purple { color: #6f42c1; }

    /* Modern Status Pills */
    .status-pill {
        padding: 6px 14px;
        border-radius: 100px;
        font-size: 0.7rem;
        font-weight: 800;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }
    .status-paid {
        background: #ecfdf5;
        color: #059669;
    }
    .status-pending {
        background: #fffbeb;
        color: #d97706;
    }

    /* Animated Dots */
    .pulse-dot {
        width: 6px; height: 6px;
        background: #059669;
        border-radius: 50%;
        box-shadow: 0 0 0 rgba(5, 150, 105, 0.4);
        animation: pulse 2s infinite;
    }
    .pulse-dot-pending {
        width: 6px; height: 6px;
        background: #d97706;
        border-radius: 50%;
        animation: pulse-pending 2s infinite;
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(5, 150, 105, 0.7); }
        70% { box-shadow: 0 0 0 6px rgba(5, 150, 105, 0); }
        100% { box-shadow: 0 0 0 0 rgba(5, 150, 105, 0); }
    }

    /* Avatar Gradient */
    .avatar-box {
        flex-shrink: 0;
    }
    {% block style %}
    {% endblock style %}
    </style>
</head>
<body>

    <div class="mobile-top-nav shadow-sm">
        <div class="d-flex align-items-center gap-2">
            <svg width="32" height="32" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="34" height="34" rx="8" fill="#6f42c1"/>
                <path d="M16.1238 20.1522C16.511 19.662 17.2479 19.6428 17.66 20.1122L20.5526 23.41C21.1194 24.0563 20.6611 25.0689 19.8016 25.0692H14.3055C13.47 25.0692 13.0026 24.1059 13.5203 23.4501L16.1238 20.1522ZM16.1326 8.45497C16.5308 7.95801 17.286 7.95453 17.6883 8.44813L27.5164 20.5077C28.0488 21.161 27.5838 22.1395 26.741 22.1395H24.4442C24.1428 22.1395 23.8577 22.0034 23.6678 21.7694L17.7029 14.4188C17.2962 13.9175 16.5285 13.927 16.1346 14.4384L10.7303 21.454C10.5411 21.6996 10.2484 21.8435 9.9383 21.8436H7.4881C6.64925 21.8436 6.18332 20.8733 6.70783 20.2186L16.1326 8.45497Z" fill="white" />
            </svg>
            <span style="font-family: 'Outfit'; font-weight: 800; font-size: 1.2rem; color: var(--pointa-purple);">Pointa.</span>
        </div>
        <button class="btn border-0 text-purple p-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileSidebar">
            <i class="fa-solid fa-bars-staggered fs-3"></i>
        </button>
    </div>
    
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileSidebar" style="width: 280px;">
      <div class="offcanvas-header border-bottom">
        <h5 class="fw-bold mb-0">Organizer Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
      </div>
      <div class="offcanvas-body">
        <nav>
            <a href="{%url 'org_dashboard'%}" class="nav-link active"><i class="fa-solid fa-chart-pie"></i> Dashboard</a>
            <a href="{%url 'create_event'%}" class="nav-link"><i class="fa-solid fa-chart-line"></i> Create Event </a>
            <a href="{%url 'my_events'%}" class="nav-link"><i class="fa-solid fa-calendar-days"></i> My Events</a>
            <a href="{%url 'organizer_tickets'%}" class="nav-link"><i class="fa-solid fa-ticket"></i> Tickets</a>
            <a href="#" class="nav-link"><i class="fa-solid fa-wallet"></i> Payouts</a>
            <div class="mt-5 pt-4 border-top">
                <p class="small fw-bold text-uppercase text-muted px-3 mt-3">Account</p>
                <a href="{% url 'organizer_profile' %}" class="nav-link"><i class="fa-solid fa-gear"></i> Profile Settings</a>
                <a href="{%url 'organizer_logout'%}" class="nav-link text-danger"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a>
            </div>
        </nav>
      </div>
    </div>

    <aside class="sidebar">
        <div class="d-flex align-items-center gap-3 mb-5">
            <svg width="42" height="42" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="34" height="34" rx="10" fill="#6f42c1"/>
                <path d="M16.1238 20.1522C16.511 19.662 17.2479 19.6428 17.66 20.1122L20.5526 23.41C21.1194 24.0563 20.6611 25.0689 19.8016 25.0692H14.3055C13.47 25.0692 13.0026 24.1059 13.5203 23.4501L16.1238 20.1522ZM16.1326 8.45497C16.5308 7.95801 17.286 7.95453 17.6883 8.44813L27.5164 20.5077C28.0488 21.161 27.5838 22.1395 26.741 22.1395H24.4442C24.1428 22.1395 23.8577 22.0034 23.6678 21.7694L17.7029 14.4188C17.2962 13.9175 16.5285 13.927 16.1346 14.4384L10.7303 21.454C10.5411 21.6996 10.2484 21.8435 9.9383 21.8436H7.4881C6.64925 21.8436 6.18332 20.8733 6.70783 20.2186L16.1326 8.45497Z" fill="white" />
            </svg>
            <a href="{%url 'home'%}" style="text-decoration: none;">
            <span style="font-family: 'Outfit'; font-weight: 800; font-size: 1.6rem; color: var(--pointa-purple);">Pointa.</span>
        </a>
        </div>

        <nav>
            <a href="{%url 'org_dashboard'%}" class="nav-link {% if request.resolver_match.url_name == 'org_dashboard' %}active{% endif %}"><i class="fa-solid fa-chart-pie"></i> Dashboard</a>
            <a href="{%url 'create_event'%}" class="nav-link {% if request.resolver_match.url_name == 'create_event' %}active{% endif %}"><i class="fa-solid fa-plus"></i> Create Event </a>
            <a href="{%url 'my_events'%}" class="nav-link {% if request.resolver_match.url_name == 'my_events' %}active{% endif %}"><i class="fa-solid fa-calendar-days"></i> My Events</a>
            <a href="{%url 'organizer_tickets'%}" class="nav-link {% if request.resolver_match.url_name == 'organizer_tickets' %}active{% endif %}"><i class="fa-solid fa-ticket"></i> Tickets</a>
            <a href="{%url 'payout'%}" class="nav-link {% if request.resolver_match.url_name == 'payout' %}active{% endif %}"><i class="fa-solid fa-wallet"></i> Payouts</a>
            <div class="mt-5 pt-4 border-top">
                <p class="small fw-bold text-uppercase text-muted px-3 mt-3">Account</p>
                <a href="{% url 'organizer_profile' %}" class="nav-link {% if request.resolver_match.url_name == 'organizer_profile' %}active{% endif %}"><i class="fa-solid fa-gear"></i> Profile Settings</a>
                <a href="{%url 'organizer_logout'%}" class="nav-link text-danger"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a>
            </div>
        </nav>
    </aside>
    <main class="main-content">
        {%block content%}
        <header class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-5 gap-4">
            <div class="flex-grow-1">
                <h2 class="fw-800 mb-1" style="letter-spacing: -0.5px;">Welcome, {{organizer.organization_name}}</h2>
                <p class="text-muted mb-0">Here’s what’s happening with your events today.</p>
            </div>
        
            <div class="d-flex flex-column flex-sm-row gap-3 align-items-stretch align-items-md-center">
                <div class="position-relative" style="min-width: 280px;">
                    <i class="fa-solid fa-magnifying-glass position-absolute text-muted" style="left: 15px; top: 50%; transform: translateY(-50%);"></i>
                    <input type="text" class="search-bar border ps-5" placeholder="Search orders..." style="height: 48px; background: #fff;">
                </div>
                
                <a href="{% url 'create_event' %}" 
                class="btn btn-create shadow-sm px-4" 
                style="height: 48px;">
                 <i class="fa-solid fa-plus me-2"></i> Create Event
             </a>
            </div>
        </header>

        <div class="row g-4 mb-5">
            {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible fade show text-center" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
            <div class="col-6 col-xl-3 col-md-6">
                <div class="stat-card">
                    <div class="icon-square text-center" style="background: #eef2ff; color: #4f46e5;"><i class="fa-solid fa-users text-center"></i></div>
                    <h3 class="fw-800 mb-1 text-center">{{total_attendees}}</h3>
                    <p class="text-muted small fw-bold mb-0 text-center">TOTAL ATTENDEES</p>
                </div>
            </div>
            <div class="col-6 col-xl-3 col-md-6">
                <div class="stat-card">
                    <div class="icon-square text-center" style="background: #f0fdf4; color: #16a34a;"><i class="fa-solid fa-naira-sign"></i></div>
                    <h3 class="fw-800 mb-1 text-center">{{total_revenue|intcomma}}</h3>
                    <p class="text-muted small fw-bold mb-0 text-center">TOTAL REVENUE</p>
                </div>
            </div>
            <div class="col-6 col-xl-3 col-md-6">
                <div class="stat-card">
                    <div class="icon-square text-center" style="background: #fff7ed; color: #ea580c;"><i class="fa-solid fa-ticket"></i></div>
                    <h3 class="fw-800 mb-1 text-center">{{total_events}}</h3>
                    <p class="text-muted small fw-bold mb-0 text-center">TOTAL EVENTS</p>
                </div>
            </div>
            <div class="col-6 col-xl-3 col-md-6">
                <div class="stat-card">
                    <div class="icon-square text-center" style="background: #fdf2f8; color: #db2777;"><i class="fa-solid fa-heart"></i></div>
                    <h3 class="fw-800 mb-1 text-center">{{total_paid_orders}}</h3>
                    <p class="text-muted small fw-bold mb-0 text-center">TOTAL PAID ORDERS</p>
                </div>
            </div>
        </div>

        <div class="custom-table shadow-sm border-0">
            <div class="p-4 d-flex justify-content-between align-items-center bg-white border-bottom rounded-top-4">
                <h5 class="fw-800 mb-0">Recent Registrations</h5>
                <span class="badge bg-light text-dark border px-3 py-2">
                    Total Attendees: {{ total_attendees|intcomma }}
                </span>
            </div>
            <div class="registration-container mt-4">
                <div class="d-flex justify-content-between align-items-end mb-4 px-2">
                    <div>
                        <h4 class="fw-800 mb-1" style="font-family: 'Outfit';">Recent Activity</h4>
                        <p class="text-muted small mb-0">You have <span class="text-primary fw-bold">{{ orders.count }}</span> new registrations this period.</p>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-light btn-sm border fw-700 px-3 py-2 rounded-3" type="button" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-filter me-2"></i> Filter
                        </button>
                        <ul class="dropdown-menu shadow-sm border-0">
                            <li><a class="dropdown-item" href="#">Paid Only</a></li>
                            <li><a class="dropdown-item" href="#">Pending Only</a></li>
                        </ul>
                    </div>
                </div>
            
                <div class="reg-list-wrapper">
                    {% for order in orders %}
                    <div class="reg-card mb-3 p-3 bg-white shadow-sm border rounded-4 transition-hover">
                        <div class="row align-items-center">
                            <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="avatar-box rounded-circle d-flex align-items-center justify-content-center text-white fw-bold shadow-sm" 
                                    style="width: 48px; height: 48px; background: linear-gradient(135deg, #6f42c1, #a855f7); font-size: 0.9rem;">
                                   
                                   {% if order.user.first_name or order.user.last_name %}
                                       {{ order.user.first_name|slice:":1"|upper }}{{ order.user.last_name|slice:":1"|upper }}
                                   {% elif order.user.username %}
                                       {{ order.user.username|slice:":2"|upper }}
                                   {% else %}
                                       <i class="fa-solid fa-user"></i>
                                   {% endif %}
                               </div>
                                    <div class="overflow-hidden">
                                        <h6 class="fw-800 mb-0 text-dark text-truncate">{{ order.user.get_full_name }}</h6>
                                        <span class="small text-muted d-block text-truncate">{{ order.user.email }}</span>
                                    </div>
                                </div>
                            </div>
            
                            <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                                <div class="ps-lg-3">
                                    <span class="x-small text-uppercase fw-800 text-muted ls-1">Event</span>
                                    <div class="fw-700 text-dark text-truncate mt-1">{{ order.event.title }}</div>
                                    <div class="small text-muted"><i class="fa-regular fa-calendar-check me-1"></i> {{ order.event.date|date:"M d, Y" }}</div>
                                </div>
                            </div>
            
                            <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                                <div class="ps-lg-3">
                                    <span class="x-small text-uppercase fw-800 text-muted ls-1">Selection</span>
                                    <div class="mt-1 d-flex flex-wrap gap-1">
                                        {% for item in order.items.all %}
                                            <span class="badge bg-soft-purple text-purple border-0 px-2 py-1" style="font-size: 0.65rem;">
                                                {{ item.ticket.name|upper }} <span class="opacity-50">x{{ item.quantity }}</span>
                                            </span>
                                        {% endfor %}
                                    </div>
                                    <div class="fw-800 text-dark mt-1">₦{{ order.total_amount|floatformat:0|intcomma }}</div>
                                </div>
                            </div>
            
                            <div class="col-lg-3 col-md-6 text-lg-end">
                                <div class="d-flex flex-row flex-lg-column justify-content-between align-items-center align-items-lg-end gap-2">
                                    {% if order.status == 'paid' %}
                                        <span class="status-pill status-paid">
                                            <span class="pulse-dot"></span> PAID
                                        </span>
                                    {% else %}
                                        <span class="status-pill status-pending">
                                            <span class="pulse-dot-pending"></span> PENDING
                                        </span>
                                    {% endif %}
                                    <code class="small fw-bold text-muted bg-light px-2 py-1 rounded">#PTA-{{ order.reference|slice:":8" }}</code>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center py-5 bg-white rounded-4 border">
                        <img src="https://illustrations.popsy.co/purple/searching.svg" style="height: 150px;" class="mb-3">
                        <h5 class="fw-800">No registrations found</h5>
                        <p class="text-muted small">When users register for your event, they will appear here.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        {%endblock content%}
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>